@page "/signup"
@inject NavigationManager NavigationManager
@inject Chatty.Services.DalUser DalUser

<div class="login-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-5 col-lg-4">
                <div class="login-card">
                    <div class="login-header">
                        <h3>Create Account</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="form-group">
                            <label class="form-label" for="username">Username</label>
                            <input @bind="username" 
                                   id="username" 
                                   type="text" 
                                   class="form-control" 
                                   placeholder="Choose a username"
                                   disabled="@isLoading" />
                            <span class="input-icon">üë§</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="password">Password</label>
                            <input @bind="password" 
                                   id="password" 
                                   type="password" 
                                   class="form-control" 
                                   placeholder="Choose a password"
                                   disabled="@isLoading" />
                            <span class="input-icon">üîí</span>
                        </div>
                         <div class="form-group">
                            <label class="form-label" for="confirmPassword">Confirm Password</label>
                            <input @bind="confirmPassword" 
                                   id="confirmPassword" 
                                   type="password" 
                                   class="form-control" 
                                   placeholder="Confirm your password"
                                   disabled="@isLoading" />
                            <span class="input-icon">üîí</span>
                        </div>

                        <button @onclick="Register" 
                                class="btn btn-login btn-primary w-100 text-white" 
                                disabled="@isLoading">
                            @if (isLoading)
                            {
                                <span class="spinner"></span>
                                <span>Creating Account...</span>
                            }
                            else
                            {
                                <span>Sign Up</span>
                            }
                        </button>

                        <div class="text-center mt-3">
                            <span class="text-muted">Already have an account? </span>
                            <a href="" class="text-primary font-weight-bold" style="text-decoration: none;">Login</a>
                        </div>
                        
                        @if (showError)
                        {
                            <div class="alert alert-danger mt-3" role="alert">
                                <strong>‚ö†Ô∏è Registration failed!</strong><br />
                                @errorMessage
                            </div>
                        }
                        
                        @if (showSuccess)
                        {
                            <div class="alert alert-success mt-3" role="alert">
                                <strong>‚úì Success!</strong> Account created. Redirecting...
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string username;
    private string password;
    private string confirmPassword;
    private bool showError = false;
    private string errorMessage = "";
    private bool showSuccess = false;
    private bool isLoading = false;

    private async Task Register()
    {
        showError = false;
        showSuccess = false;
        isLoading = true;

        await Task.Delay(1000); // Simulate network

        if (password != confirmPassword) {
            showError = true;
            errorMessage = "Passwords do not match.";
            isLoading = false;
            return;
        }
        NavigationManager.NavigateTo("/");

        //bool isRegistered = await DalUser.RegisterUser(username, password);

        //if (isRegistered)
        //{
        //    showSuccess = true;
        //    await Task.Delay(1000);
        //    NavigationManager.NavigateTo("/");
        //}
        //else
        //{
        //    showError = true;
        //    errorMessage = "Username already exists or is invalid.";
        //    isLoading = false;
        //}
    }
}
